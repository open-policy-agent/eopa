# syncmock is used by all commands in this file
# it has to expect failure (the "!") because it's
# killed at the end of the process
! exec syncmock --port 9995 --cookie-file .styra-session &
[darwin] exec sleep 1

exec eopa pull --log-level warn --url http://127.0.0.1:9995 --libraries foo/bar
! stdout .
! stderr .
cmp exp/.styra.yaml .styra.yaml
exec ls -alR foo/bar
exec diff -r exp-tgt foo/bar

-- .styra-session --
opensesame

-- exp/.styra.yaml --
# generated by `eopa login`
data:
- foo/bar
url: http://127.0.0.1:9995
-- exp-tgt/.gitignore --
*
-- exp-tgt/libraries/lib02/envoy/policy.rego --
package libraries.lib02.envoy
import future.keywords
allow if true
-- exp-tgt/libraries/lib02/token/data.json --
{"bearer_token":"testtoken"}
-- exp-tgt/libraries/lib02/thing/data.json --
{"data":{"one":{"foo":1},"two":{"foo":2}}}
